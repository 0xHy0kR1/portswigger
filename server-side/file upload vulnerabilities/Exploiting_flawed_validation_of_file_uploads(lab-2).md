## Introduction
- When submitting HTML forms, the browser typically sends the provided data in a `POST` request with the content type `application/x-www-form-url-encoded`. This is fine for sending simple text like your name, address, and so on.
- But is not suitable for sending large amounts of binary data, such as an entire image file or a PDF document. In this case, the content type `multipart/form-data` is the preferred approach.

**Consider a form containing fields for uploading an image, providing a description of it, and entering your username.
Submitting such a form might result in a request that looks something like this:**
![[file-upload-vulnerabilities3.png]]

- As you can see, the message body is split into separate parts for each of the form's inputs. Each part contains a `Content-Disposition` header, which provides some basic information about the input field it relates to.
- These individual parts may also contain their own `Content-Type` header, which tells the server the MIME type of the data that was submitted using this input.
**Example** - 
it may only allow types like `image/jpeg` and `image/png`. Problems can arise when the value of this header is implicitly trusted by the server. If no further validation is performed to check whether the contents of the file actually match the supposed MIME type, this defense can be easily bypassed using tools like Burp Repeater.

## Steps to solve lab
### Desc - Web shell upload via Content-Type restriction bypass

**Our end goal** - upload a basic PHP web shell and use it to exfiltrate the contents of the file `/home/carlos/secret`. Submit this secret using the button provided in the lab banner.

1. Login with the given credentials(wiener:peter)
2. Try to upload old `shell.php` from the client-side and then you get a message indicating this type of file upload can't be successful because of MIME type is `application/octet-stream` but application only allowed MIME type of `image/jpeg` and `image/png`.
![[file-upload-vulnerabilities4.png]]

3. In burp send `POST /my-account/avatar` to burp repeater and change the MIME type from `application/octet-stream` to `image/jpeg` and `image/png`.
![[file-upload-vulnerabilities5.png]]

4. Now, browse "/files/avatars/shell.php" and you get the content "secret" file.
![[file-upload-vulnerabilities6.png]]

